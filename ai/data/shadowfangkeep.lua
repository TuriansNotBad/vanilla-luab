t_dungeons[33] = {
	-- entrance gate
	{
		{-228.191, 2111.41, 76.8904, -1000, 2}, -- 1
		{-220.877, 2142.11, 80.9196, -1000, 2}, -- 2
	},
	-- inside to first fork
	{
		{-219.238, 2108.68, 76.889, -1000, 2}, -- 1
		{-203.179, 2099.18, 76.8931, -1000, 2}, -- 2
		{-200.635, 2106.79, 78.5568, -1000, 2}, -- 3
		{-208.342, 2109.55, 81.0548, -1000, 2}, -- 4
		{-188.265, 2139.25, 83.1672, -1000, 2}, -- 5
		{-198.543, 2144.88, 86.5014, -1000, 2}, -- 6
		{-204.212, 2137.79, 86.4991, -1000, 2}, -- 7
		{-207.71, 2125.65, 86.5016, -1000, 2}, -- 8
	},
	-- inside to fork near stair to prison
	{
		{-200.498, 2145.83, 87.1523, -1000, 2}, -- 1
		{-210.862, 2141.19, 90.6254, -1000, 2}, -- 2
		{-234.272, 2149.99, 90.624, -1000, 2}, -- 3
		{-248.417, 2112.41, 87.0128, -1000, 2}, -- 4
	},
	-- prison stair path
	{
		{-242.609, 2141.64, 87.0137, -1000, 2}, -- 1
		{-249.093, 2144.28, 87.012, -1000, 2}, -- 2
		{-258.628, 2117.81, 81.1795, -1000, 2}, -- 3
	},
	-- prison floor path
	{
		{-245.436, 2138.37, 81.1795, -1000, 2}, -- 1
		{-254.634, 2114.36, 81.1795, -1000, 2}, -- 2
	},
	-- cell 1
	{
		{-242.869, 2134.01, 81.1795, -1000, 2}, -- 1
		{-233.619, 2130.36, 81.1821, -1000, 2}, -- 2
	},
	-- cell 2
	{
		{-247.299, 2125.22, 81.1795, -1000, 2}, -- 1
		{-234.224, 2120.23, 81.7747, -1000, 2}, -- 2
	},
	-- cell 3
	{
		{-250.644, 2116.25, 81.1795, -1000, 2}, -- 1
		{-237.783, 2111.2, 81.7744, -1000, 2}, -- 2
	},
	-- stair to courtyard to stable
	{
		{-237.143, 2151.69, 90.624, -1000, 2}, -- 1
		{-242.303, 2154.73, 90.624, -1000, 2}, -- 2
		{-231.513, 2182.98, 79.7555, -1000, 2}, -- 3
		{-216.306, 2198.23, 79.7647, -1000, 2}, -- 4
		{-204.987, 2221.13, 79.7616, -1000, 2}, -- 5
		{-208.101, 2241.52, 79.7627, -1000, 2}, -- 6
		{-234.761, 2235.77, 79.7775, -1000, 2}, -- 7
	},
	-- courtyard to entrance gate
	{
		{-225.496, 2180.95, 79.7657, -1000, 2}, -- 1
		{-213.56, 2168.1, 79.7657, -1000, 2}, -- 2
		{-220.21, 2143.86, 80.948, -1000, 2}, -- 3
	},
	-- courtyard near well by gate
	{
		{-210.129, 2165.85, 79.7656, -1000, 2}, -- 1
		{-193.711, 2157.92, 79.7633, -1000, 2}, -- 2
	},
	-- from courtyard stables to final boss
	{
		{-200.992, 2220.71, 79.7599, -1000, 2}, -- 1
		{-185.794, 2216.52, 79.7504, -1000, 2}, -- 2
		{-173.975, 2216.93, 80.2839, -1000, 2}, -- 3
		{-161.537, 2222.5, 82.0638, -1000, 2}, -- 4
		{-156.141, 2233.09, 84.1875, -1000, 2}, -- 5
		{-162.734, 2244.87, 86.1911, -1000, 2}, -- 6
		{-174.919, 2255.27, 86.4689, -1000, 2}, -- 7
		{-194.449, 2265.06, 90.6425, -1000, 2}, -- 8
		{-185.541, 2288.19, 95.899, -1000, 2}, -- 9
		{-286.353, 2327.31, 95.8664, -1000, 2}, -- 10
		{-302.543, 2284.44, 95.8665, -1000, 2}, -- 11
		{-251.741, 2264.8, 100.889, -1000, 2}, -- 12
		{-246.121, 2254.09, 100.893, -1000, 2}, -- 13
		{-251.561, 2243.46, 100.892, -1000, 2}, -- 14
		{-248.763, 2232.64, 99.0077, -1000, 2}, -- 15
		{-240.177, 2230.03, 94.9881, -1000, 2}, -- 16
		{-233.602, 2231.08, 93.5399, -1000, 2}, -- 17
		{-232.86, 2216.69, 97.3441, -1000, 2}, -- 18
		{-239.862, 2189.98, 97.3438, -1000, 2}, -- 19
		{-253.371, 2160.95, 93.897, -1000, 2}, -- 20
		{-247.522, 2158.18, 92.5263, -1000, 2}, -- 21
		{-250.14, 2151.92, 91.1063, -1000, 2}, -- 22
		{-255.298, 2153.32, 91.1039, -1000, 2}, -- 23
		{-257.823, 2145.88, 92.8034, -1000, 2}, -- 24
		{-266.429, 2150.86, 95.7934, -1000, 2}, -- 25
		{-269.491, 2142.88, 95.9837, -1000, 2}, -- 26
		{-257.283, 2138.25, 100.029, -1000, 2}, -- 27
		{-240.319, 2144.66, 100.029, -1000, 2}, -- 28
		{-248.941, 2122.69, 100.029, -1000, 2}, -- 29
		{-258.139, 2121.73, 100.029, -1000, 2}, -- 30
		{-260.737, 2115.63, 100.029, -1000, 2}, -- 31
		{-210.886, 2097.72, 97.3898, -1000, 2}, -- 32
		{-181.227, 2172.26, 97.3898, -1000, 2}, -- 33
		{-182.142, 2181.22, 98.0566, -1000, 2}, -- 34
		{-172.665, 2184.78, 96.1067, -1000, 2}, -- 35
		{-169.982, 2172.15, 94.0565, -1000, 2}, -- 36
		{-133.282, 2160.59, 94.0416, -1000, 2}, -- 37
		{-130.263, 2169.38, 94.0451, -1000, 2}, -- 38
		{-148.377, 2173.24, 99.8761, -1000, 2}, -- 39
		{-157.862, 2176.71, 102.187, -1000, 2}, -- 40
		{-153.956, 2187.67, 104.958, -1000, 2}, -- 41
		{-148.369, 2185.65, 106.911, -1000, 2}, -- 42
		{-141.419, 2182.75, 109.931, -1000, 2}, -- 43
		{-136.845, 2180.98, 112.695, -1000, 2}, -- 44
		{-120.965, 2175.01, 112.695, -1000, 2}, -- 45
		{-116.94, 2173.29, 110.685, -1000, 2}, -- 46
		{-103.389, 2167.39, 104.935, -1000, 2}, -- 47
		{-108.35, 2155.58, 101.52, -1000, 2}, -- 48
		{-127.889, 2156.69, 101.709, -1000, 2}, -- 49
		{-136.545, 2160.01, 104.406, -1000, 2}, -- 50
		{-142.76, 2162.39, 106.356, -1000, 2}, -- 51
		{-152.064, 2165.96, 109.141, -1000, 2}, -- 52
		{-173.12, 2174.51, 109.254, -1000, 2}, -- 53
		{-171.806, 2184.72, 110.833, -1000, 2}, -- 54
		{-176.62, 2190.49, 112.45, -1000, 2}, -- 55
		{-185.076, 2187.12, 114.448, -1000, 2}, -- 56
		{-185.134, 2179.77, 116.107, -1000, 2}, -- 57
		{-176.51, 2175.91, 118.463, -1000, 2}, -- 58
		{-170.925, 2184.53, 120.723, -1000, 2}, -- 59
		{-181.209, 2190.15, 123.467, -1000, 2}, -- 60
		{-185.658, 2179.89, 126.069, -1000, 2}, -- 61
		{-176.228, 2175.71, 128.494, -1000, 2}, -- 62
		{-170.166, 2182.67, 129.255, -1000, 2}, -- 63
		{-122.328, 2163.36, 128.944, -1000, 2}, -- 64
		{-117.513, 2177.21, 130.61, -1000, 2}, -- 65
		{-126.382, 2196.47, 133.093, -1000, 2}, -- 66
		{-148.999, 2203.09, 135.937, -1000, 2}, -- 67
		{-166.399, 2192.66, 138.369, -1000, 2}, -- 68
		{-170.853, 2182.08, 138.697, -1000, 2}, -- 69
		{-160.877, 2178.39, 138.697, -1000, 2}, -- 70
		{-160.363, 2167.55, 138.697, -1000, 2}, -- 71
		{-149.589, 2158.9, 138.697, -1000, 2}, -- 72
		{-137.705, 2161.89, 138.697, -1000, 2}, -- 73
		{-129.971, 2166.99, 138.697, -1000, 2}, -- 74
		{-122.417, 2163.75, 138.697, -1000, 2}, -- 75
		{-118.063, 2178.67, 140.948, -1000, 2}, -- 76
		{-125.024, 2195.2, 143.963, -1000, 2}, -- 77
		{-138.378, 2201.06, 146.491, -1000, 2}, -- 78
		{-154.616, 2200.46, 149.467, -1000, 2}, -- 79
		{-170.859, 2182.82, 151.906, -1000, 2}, -- 80
		{-152.089, 2175.49, 155.678, -1000, 2}, -- 81
		{-109.08, 2158.16, 155.678, -1000, 2}, -- 82
		{-117.955, 2134.6, 144.921, -1000, 2}, -- 83
		{-90.1698, 2143.6, 144.921, -1000, 2}, -- 84
		{-81.6178, 2140.12, 148.365, -1000, 2}, -- 85
		{-76.1366, 2154.48, 155.701, -1000, 2}, -- 86
	},
	-- Left side of circle room
	{
		{-159.391, 2181.56, 138.697, -1000, 2}, -- 1
		{-148.625, 2187.73, 138.697, -1000, 2}, -- 2
		{-136.86, 2183.82, 138.697, -1000, 2}, -- 3
		{-130.495, 2169.62, 138.697, -1000, 2}, -- 4
	},
	-- Kitchen to dining area to right stair
	{
		{-177.596, 2223.89, 79.4896, -1000, 2}, -- 1
		{-179.347, 2233.73, 76.2407, -1000, 2}, -- 2
		{-181.973, 2243, 76.2013, -1000, 2}, -- 3
		{-186.947, 2250.34, 76.2013, -1000, 2}, -- 4
		{-214.188, 2264.24, 76.2013, -1000, 2}, -- 5
		{-221.636, 2267.3, 74.9993, -1000, 2}, -- 6
		{-228.321, 2271.39, 74.9993, -1000, 2}, -- 7
		{-223.925, 2283.93, 74.9993, -1000, 2}, -- 8
		{-258.927, 2300.31, 74.9993, -1000, 2}, -- 9
		{-263.64, 2302.19, 77.5953, -1000, 2}, -- 10
		{-269.831, 2304.63, 80.9518, -1000, 2}, -- 11
		{-275.643, 2307.06, 82.5186, -1000, 2}, -- 12
		{-280.429, 2307.94, 85.6021, -1000, 2}, -- 13
		{-284.791, 2306.13, 88.931, -1000, 2}, -- 14
		{-287.138, 2304.3, 90.6056, -1000, 2}, -- 15
	},
	-- Dining area left side to boss
	{
		{-230.282, 2272.2, 74.9993, -1000, 2}, -- 1
		{-259.59, 2286.27, 74.9993, -1000, 2}, -- 2
		{-265.756, 2293.14, 76.1533, -1000, 2}, -- 3
		{-274.911, 2297.01, 76.1532, -1000, 2}, -- 4
	},
	-- Dining area left stair
	{
		{-264.582, 2284.26, 74.9993, -1000, 2}, -- 1
		{-270.75, 2286.62, 78.0551, -1000, 2}, -- 2
		{-278.59, 2289.64, 81.3588, -1000, 2}, -- 3
		{-285.031, 2292.34, 84.5668, -1000, 2}, -- 4
		{-288.108, 2297.01, 88.4213, -1000, 2}, -- 5
		{-288.23, 2301.56, 90.6056, -1000, 2}, -- 6
	},
};

local ShadowfangKeep = t_dungeons[33];

local _losTbl = Encounter_MakeLOSTbl()
	-- Opening, castle
	.new 'CastleSidewalk' {-195.349, 2133.37, 81.5003} {-197.726, 2122.84, 81.5003}
	.new 'CastleTopFloor' {-228.356, 2144.98, 90.6241} {-214.818, 2143.14, 90.6241}
	.new 'Castle1stBoss_' {-238.627, 2141.00, 87.0129} {-234.820, 2150.39, 90.6241}
	.new 'CastleEatRmStd' {-199.552, 2257.33, 76.2014} {-185.744, 2247.38, 76.2014}
	.new 'CastleEatRmAlt' {-287.445, 2314.70, 93.1306} {-287.718, 2330.05, 95.8666}
	.new 'CastleKtchnStd' {-186.108, 2217.03, 79.7525} {-197.868, 2206.02, 79.7624}
	.new 'CastleKtchnAlt' {-225.764, 2278.29, 74.9994} {-239.959, 2289.51, 74.9994}
	.new 'CastleStreets_' {-238.893, 2166.14, 89.0407} {-243.275, 2151.84, 90.5313}
	.new 'CastleStables_' {-212.070, 2204.41, 79.7646} {-224.285, 2191.58, 79.7653}
	-- Ramparts and end
	.new 'RampsGhostRoom' {-282.229, 2277.97, 95.8666} {-296.025, 2282.25, 95.8666}
	.new 'RampsOdosRoom_' {-254.697, 2153.44, 91.1029} {-266.595, 2149.85, 95.8234}
	.new 'ArugalBossRoom' {-125.761, 2164.87, 155.679} {-144.110, 2171.72, 155.679}
.endtbl();

local _areaTbl = Encounter_MakeAreaTbl(_losTbl)
	-- Opening, castle
	.new ('CastleSidewalk', SHAPE_POLYGON) {-196.148, 2145.64} {-206.031, 2123.93} {-213.133, 2126.21} {-207.259, 2150.08} ('CastleSidewalk', 86.50, 2.0)
	.new ('CastleTopFloor', SHAPE_POLYGON) {-223.258, 2140.42} {-238.544, 2107.65} {-252.237, 2113.26} {-241.728, 2142.40} ('CastleTopFloor', 87.00, 2.0)
	.new ('Castle1stBoss_', SHAPE_POLYGON) {-251.987, 2142.72} {-262.156, 2116.91} {-251.300, 2113.19} {-241.631, 2137.94} ('Castle1stBoss_', 81.18, 5.0)
	.new ('CastleDineRoom', SHAPE_POLYGON) {-222.258, 2264.20} {-279.998, 2286.95} {-271.461, 2308.58} {-213.733, 2285.84} ('CastleEatRmStd', 75.00, 10.0)
	.new ('CastleKitchen_', SHAPE_POLYGON) {-208.463, 2276.37} {-172.915, 2231.87} {-184.742, 2228.82} {-218.544, 2253.36} ('CastleKtchnStd', 75.00, 10.0)
	.new ('CastleStreets_', SHAPE_POLYGON) {-244.861, 2163.00} {-196.594, 2145.81} {-191.507, 2203.95} {-226.054, 2214.52} ('CastleStreets_', 79.70, 10.0)
	.new ('CastleStables_', SHAPE_POLYGON) {-203.450, 2235.52} {-234.519, 2226.01} {-239.952, 2243.78} {-209.802, 2255.12} ('CastleStables_', 80.00, 10.0)
	-- Ramparts and end
	.new ('RampsGhostRoom', SHAPE_POLYGON) {-224.060, 2269.30} {-217.371, 2250.97} {-261.035, 2236.48} {-267.217, 2255.86} ('RampsGhostRoom', 103.00, 7.0)
	.new ('RampsOdosRoom_', SHAPE_POLYGON) {-266.469, 2116.07} {-250.013, 2153.91} {-234.099, 2147.60} {-247.641, 2109.72} ('RampsOdosRoom_', 100.00, 2.0)
	.new ('ArugalBossRoom', SHAPE_POLYGON) {-126.598, 2130.98} {-83.8432, 2114.14} {-68.7161, 2157.21} {-109.658, 2173.89} ('ArugalBossRoom', 144.00, 10.0)
.endtbl();

local NPC_RANGED_LIST = Encounter_NewRangedList();
function NPC_RANGED_LIST.IsRanged() return true; end

local function TriggerCircle_DoorToKitchen(unit, hive, data)
	Print("TriggerCircle_DoorToKitchen");
	Encounter_SetAreaLosPos("CastleDineRoom", data.dungeon.AreaTbl, data.dungeon.LosTbl, "CastleEatRmStd");
	Encounter_SetAreaLosPos("CastleKitchen_", data.dungeon.AreaTbl, data.dungeon.LosTbl, "CastleKtchnStd");
end

local function TriggerCircle_DoorToDineRoom(unit, hive, data)
	Print("TriggerCircle_DoorToDineRoom");
	Encounter_SetAreaLosPos("CastleDineRoom", data.dungeon.AreaTbl, data.dungeon.LosTbl, "CastleEatRmAlt");
	Encounter_SetAreaLosPos("CastleKitchen_", data.dungeon.AreaTbl, data.dungeon.LosTbl, "CastleKtchnAlt");
end

ShadowfangKeep.triggers = {
	Encounter_NewTriggerCircle("DoorToKitchen",  -177.320,2217.78,79.7495,18,15, TriggerCircle_DoorToKitchen),
	Encounter_NewTriggerCircle("DoorToDineRoom", -289.196,2316.64,93.6324,20,10, TriggerCircle_DoorToDineRoom),
};

ShadowfangKeep.encounters = {
	{name = "Rethilgore"},
	{name = "Razorclaw the Butcher"},
	{name = "Baron Silverlaine"},
	{name = "Commander Springvale"},
	{name = "Odo the Blindwatcher"},
	{name = "Fenrus the Devourer"},
	{name = "Wolf Master Nandos"},
	-- end boss
	{
		name = "Archmage Arugal",
		tankswap = true,
		hold_area = {
			tp = "circle",
			r = 10.0,
			pos = {x = -80.303, y = 2153.950, z = 155.677},
			dpspos = {x = -83.749, y = 2151.337, z = 155.634}
			-- dpspos = {x = -69.541, y = 2157.347, z = 155.830}
		}
	},
	{
		name               = "Global",
		test               = function() return true; end,
		UseLosBreakForPull = true,
		noboss             = true,
	},
};

ShadowfangKeep.encounters.LosTbl    = _losTbl;
ShadowfangKeep.encounters.AreaTbl   = _areaTbl;
ShadowfangKeep.encounters.RangedTbl = NPC_RANGED_LIST;
