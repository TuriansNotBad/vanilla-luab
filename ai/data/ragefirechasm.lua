
import 'ai/common_encounter.lua'

t_dungeons[389] = {
	-- Line 1
	{
		{4.54797, -9.69582, -16.178, -1000, 2}, -- 1
		{-7.43574, -43.5315, -21.853, -1000, 2}, -- 2
		{-25.3452, -48.0892, -21.8637, -1000, 2}, -- 3
		{-66.8257, -34.3237, -17.4815, -1000, 2}, -- 4
		{-187.882, -33.6584, -45.1062, -1000, 2}, -- 5
		{-260.879, -38.1686, -60.7073, -1000, 2}, -- 6
		{-284.762, -52.2705, -60.9322, -1000, 2}, -- 7
	},
	-- Line 2
	{
		{-287, -74.6776, -60.5401, -1000, 2}, -- 1
		{-287.175, -83.6145, -60.6155, -1000, 2}, -- 2
		{-283.702, -89.9275, -61.9013, -1000, 2}, -- 3
		{-278.768, -92.944, -61.9013, -1000, 2}, -- 4
		{-271.755, -97.993, -61.9022, -1000, 2}, -- 5
		{-260.161, -88.354, -60.9867, -1000, 2}, -- 6
		{-256.811, -82.2956, -60.8232, -1000, 2}, -- 7
		{-256.918, -70.7167, -62.1714, -1000, 2}, -- 8
		{-253.828, -62.5854, -62.0127, -1000, 2}, -- 9
		{-239.589, -60.279, -61.8447, -1000, 2}, -- 10
		{-230.893, -60.174, -61.0097, -1000, 2}, -- 11
		{-225.671, -65.9674, -61.2362, -1000, 2}, -- 12
		{-192.804, -71.6513, -62.3081, -1000, 2}, -- 13
		{-175.044, -65.0176, -57.8186, -1000, 2}, -- 14
		{-147.22, -66.1689, -59.5939, -1000, 2}, -- 15
		{-146.668, -50.8184, -57.5487, -1000, 2}, -- 16
		{-162.477, -41.7314, -59.1733, -1000, 2}, -- 17
		{-159.246, -22.5014, -57.415, -1000, 2}, -- 18
		{-141.612, -18.9465, -54.8175, -1000, 2}, -- 19
		{-138.768, -4.53144, -53.2538, -1000, 2}, -- 20
	},
	-- Line 3
	{
		{-288.108, -31.9991, -60.5794, -1000, 2}, -- 1
		{-283.172, -18.9197, -61.227, -1000, 2}, -- 2
		{-271.429, -9.36055, -63.235, -1000, 2}, -- 3
		{-260.855, -4.78876, -63.83, -1000, 2}, -- 4
		{-225.9, -11.265, -61.8094, -1000, 2}, -- 5
		{-194.51, 1.33388, -60.5897, -1000, 2}, -- 6
		{-167.958, 6.72371, -49.8261, -1000, 2}, -- 7
		{-149.41, 2.47184, -39.5532, -1000, 2}, -- 8
		{-149.069, 28.7864, -38.8852, -1000, 2}, -- 9
	},
	-- Line 4
	{
		{-298.166, -42.0178, -60.9245, -1000, 2}, -- 1
		{-307.123, -11.5364, -54.8222, -1000, 2}, -- 2
		{-298.541, 6.1901, -47.9807, -1000, 2}, -- 3
		{-191.871, 8.86944, -33.3047, -1000, 2}, -- 4
		{-168.25, 14.8034, -29.38, -1000, 2}, -- 5
		{-133.822, 6.82453, -20.8654, -1000, 2}, -- 6
		{-114.183, 18.9012, -18.8669, -1000, 2}, -- 7
		{-101.536, 60.5139, -18.2839, -1000, 2}, -- 8
		{-136.976, 79.9017, -21.037, -1000, 2}, -- 9
		{-166.277, 72.2728, -21.0495, -1000, 2}, -- 10
		{-201.023, 87.1253, -24.7822, -1000, 2}, -- 11
	},
	-- Line 5
	{
		{-222.114, 91.9972, -25.0184, -1000, 2}, -- 1
		{-235.328, 93.1566, -21.8162, -1000, 2}, -- 2
		{-264.244, 93.052, -25.0178, -1000, 2}, -- 3
		{-283.622, 96.4239, -25.0198, -1000, 2}, -- 4
		{-302.642, 111.882, -26.5258, -1000, 2}, -- 5
		{-308.699, 136.016, -24.7666, -1000, 2}, -- 6
		{-298.783, 145.175, -24.9789, -1000, 2}, -- 7
		{-294.291, 179.389, -21.3446, -1000, 2}, -- 8
		{-295.966, 195.55, -25.2663, -1000, 2}, -- 9
	},
	-- Line 6
	{
		{-199.104, 107.483, -24.7669, -1000, 2}, -- 1
		{-192.961, 138.117, -24.4671, -1000, 2}, -- 2
		{-179.529, 166.014, -25.0197, -1000, 2}, -- 3
		{-181.64, 194.382, -25.7571, -1000, 2}, -- 4
		{-204.056, 212.248, -23.9637, -1000, 2}, -- 5
		{-218.748, 216.819, -25.0065, -1000, 2}, -- 6
		{-239.362, 208.872, -24.9005, -1000, 2}, -- 7
		{-268.832, 211.208, -24.5695, -1000, 2}, -- 8
	},
	-- Line 7
	{
		{-202.031, 155.351, -25.1788, -1000, 2}, -- 1
		{-229.899, 151.616, -18.9365, -1000, 2}, -- 2
		{-241.606, 153.376, -18.743, -1000, 2}, -- 3
		{-234.104, 190.804, -24.5209, -1000, 2}, -- 4
	},
	-- Line 8
	{
		{-260.612, 110.104, -25.0119, -1000, 2}, -- 1
		{-246.292, 143.288, -18.5733, -1000, 2}, -- 2
		{-259.757, 150.701, -18.8482, -1000, 2}, -- 3
		{-283.065, 148.498, -25.4378, -1000, 2}, -- 4
	},
	-- Line 9
	{
		{-274.655, 212.557, -25.0184, -1000, 2}, -- 1
		{-320.249, 222.354, -21.5799, -1000, 2}, -- 2
		{-374.949, 195.11, -21.8843, -1000, 2}, -- 3
	},
	-- Line 10
	{
		{-244.525, 234.149, -22.788, -1000, 2}, -- 1
		{-274.547, 251.134, -16.6276, -1000, 2}, -- 2
		{-321.76, 252.19, -11.5416, -1000, 2}, -- 3
		{-373.724, 263.526, -4.84661, -1000, 2}, -- 4
		{-401.321, 217.248, -1.12583, -1000, 2}, -- 5
		{-410.396, 200.178, 3.54767, -1000, 2}, -- 6
		{-405.993, 168.298, 7.3975, -1000, 2}, -- 7
		{-376.331, 138.257, 7.7385, -1000, 2}, -- 8
	},
};

local RagefireChasm = t_dungeons[389];

local _losTbl = Encounter_MakeLOSTbl()
	.new 'TroggSidePa1' {-184.213, -74.630, -59.5850} {-208.987, -70.205, -62.2890}
	.new 'TroggSidePa2' {-152.496, -47.992, -58.4061} {-144.501, -63.272, -59.2180}
	.new 'TroggBossCav' {-229.003, -3.2381, -61.7947} {-224.965, -21.230, -61.8350}
	-- Cult area
	.new 'BeforeFinalB' {-311.436, 264.058, -12.2296} {-286.784, 255.745, -16.0371}
	.new 'InvokerRoom_' {-298.796, 205.404, -25.2740} {-275.540, 216.881, -25.0184}
	-- Web room
	.new 'WebRoomEntra' {-135.145, 84.2206, -20.9552} {-118.125, 68.9941, -21.0821}
	.new 'WebRoomEnLhs' {-258.471, 80.1171, -24.7973} {-251.753, 66.5748, -23.2528}
	.new 'WebRoomEnRhs' {-174.469, 162.833, -24.9088} {-195.830, 157.122, -25.2199}
	-- Web room L1
	.new 'WebRoomL1Nrm' {-223.573, 79.0034, -25.0184} {-186.464, 78.6635, -22.7155}
	.new 'WebRoomL1Mid' {-236.209, 138.839, -18.1346} {-241.785, 155.468, -18.7229}
	.new 'WebRoomL1Rev' {-300.716, 134.778, -24.7666} {-303.134, 144.904, -24.9703}
	.new 'WebRoomL1Top' {-211.295, 63.7467, -14.2199} {-180.642, 53.6633, -10.8304}
	-- Web room L2
	.new 'WebRoomL2Nrm' {-276.603, 102.691, -25.0182} {-270.310, 88.5103, -25.0138}
	.new 'WebRoomL2Mid' {-230.979, 149.024, -18.9025} {-242.928, 166.082, -18.5388}
	.new 'WebRoomL2Rev' {-306.521, 195.845, -24.7666} {-290.110, 210.407, -25.4456}
	-- Web room final
	.new 'WebRoomFnLhs' {-299.969, 129.492, -23.8598} {-284.668, 146.568, -25.4069}
	.new 'WebRoomFnRhs' {-243.322, 228.536, -23.6858} {-222.622, 221.401, -25.0110}
	-- Web room R1
	.new 'WebRoomR1Nrm' {-163.840, 73.5155, -21.0931} {-146.857, 74.7237, -21.5454}
	.new 'WebRoomR1Mid' {-234.878, 171.627, -18.6864} {-249.078, 154.128, -18.7637}
	.new 'WebRoomR1Rev' {-219.266, 205.800, -25.0164} {-232.153, 206.305, -24.8766}
	-- Web room R2
	.new 'WebRoomR2Nrm' {-186.072, 165.460, -25.2199} {-188.786, 150.966, -25.2199}
	.new 'WebRoomR2Mid' {-246.324, 138.605, -18.5417} {-231.438, 149.720, -18.8900}
	.new 'WebRoomR2Rev' {-270.069, 223.319, -25.0184} {-288.141, 208.116, -25.5700}
.endtbl();

local _areaTbl = Encounter_MakeAreaTbl(_losTbl)
	.new ('TroggSidePa1', SHAPE_POLYGON) {-173.688, -35.453} {-178.769, -106.07} {-127.045, -87.176} {-125.707, -45.068} ('TroggSidePa1', -57.65, 10)
	.new ('TroggSidePa2', SHAPE_POLYGON) {-173.688, -35.453} {-162.145, -1.8529} {-116.248, 13.6482} {-125.707, -45.068} ('TroggSidePa2', -55.47, 10)
	.new ('TroggBossCav', SHAPE_POLYGON) {-221.052, -24.125} {-227.599, -1.9498} {-147.004, 9.25241} {-141.916, -2.6381} ('TroggBossCav', -52.56, 15)
	-- Cult area
	.new ('BeforeFinalB', SHAPE_POLYGON) {-349.706, 251.467} {-381.020, 229.070} {-413.168, 252.483} {-351.303, 316.483} ('BeforeFinalB', -4.840, 15)
	.new ('InvokerRoom_', SHAPE_POLYGON) {-324.209, 232.414} {-393.381, 248.159} {-372.302, 135.708} {-329.314, 146.327} ('InvokerRoom_', -21.10, 15)
	-- Web room
	.new ('WebRoomEntra', SHAPE_POLYGON) {-176.622, 106.798} {-216.585, 131.137} {-233.844, 75.1676} {-177.134, 66.3165} ('WebRoomEntra', -25.00, 10)
	.new ('WebRoomLeft1', SHAPE_POLYGON) {-289.261, 95.9881} {-249.596, 70.1904} {-241.769, 116.476} {-278.218, 132.931} ('WebRoomL1Nrm', -25.00, 100)
	.new ('WebRoomLeft2', SHAPE_POLYGON) {-320.153, 167.093} {-277.393, 162.678} {-276.196, 128.579} {-309.852, 119.319} ('WebRoomL2Nrm', -25.00, 100)
	.new ('WebRoomFinal', SHAPE_POLYGON) {-269.241, 167.966} {-316.135, 187.130} {-296.859, 234.366} {-257.489, 227.895} ('WebRoomFnLhs', -25.00, 15)
	.new ('WebRoomRght1', SHAPE_POLYGON) {-210.193, 130.192} {-205.571, 174.577} {-177.298, 174.481} {-169.717, 127.389} ('WebRoomR1Nrm', -25.00, 100)
	.new ('WebRoomRght2', SHAPE_POLYGON) {-198.066, 212.978} {-244.442, 241.494} {-263.032, 187.090} {-215.730, 177.452} ('WebRoomR2Nrm', -25.00, 100)
.endtbl();

local NPC_RANGED_LIST = Encounter_NewRangedList();
function NPC_RANGED_LIST.IsRanged() return true; end

local function TriggerCircle_WREntrance(unit, hive, data)
	Print("TriggerCircle_WREntrance");
	Encounter_SetAreaLosPos("WebRoomLeft1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL1Nrm");
	Encounter_SetAreaLosPos("WebRoomRght1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR1Nrm");
end

local function TriggerCircle_BossIsland(unit, hive, data)
	Print("TriggerCircle_BossIsland");
	Encounter_SetAreaLosPos("WebRoomLeft1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL1Mid");
	Encounter_SetAreaLosPos("WebRoomLeft2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL2Mid");
	Encounter_SetAreaLosPos("WebRoomRght1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR1Mid");
	Encounter_SetAreaLosPos("WebRoomRght2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR2Mid");
end

local function TriggerCircle_WRL1Island(unit, hive, data)
	Print("TriggerCircle_WRL1Island");
	Encounter_SetAreaLosPos("WebRoomLeft2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL2Nrm");
	Encounter_SetAreaLosPos("WebRoomEntra", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomEnLhs");
end

local function TriggerCircle_WRL2Island(unit, hive, data)
	Print("TriggerCircle_WRL2Island");
	Encounter_SetAreaLosPos("WebRoomFinal", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomFnLhs");
	Encounter_SetAreaLosPos("WebRoomLeft1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL1Rev");
end

local function TriggerCircle_WRFnIsland(unit, hive, data)
	Print("TriggerCircle_WRFnIsland");
	Encounter_SetAreaLosPos("WebRoomRght2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR2Rev");
	Encounter_SetAreaLosPos("WebRoomLeft2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL2Rev");
end

local function TriggerCircle_WRMeTopPth(unit, hive, data)
	Print("TriggerCircle_WRMeTopPth");
	Encounter_SetAreaLosPos("WebRoomLeft1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomL1Top");
end

local function TriggerCircle_WRR1Island(unit, hive, data)
	Print("TriggerCircle_WRR1Island");
	Encounter_SetAreaLosPos("WebRoomRght2", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR2Nrm");
	Encounter_SetAreaLosPos("WebRoomEntra", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomEnRhs");
end

local function TriggerCircle_WRR2Island(unit, hive, data)
	Print("TriggerCircle_WRR2Island");
	Encounter_SetAreaLosPos("WebRoomFinal", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomFnRhs");
	Encounter_SetAreaLosPos("WebRoomRght1", data.dungeon.AreaTbl, data.dungeon.LosTbl, "WebRoomR1Rev");
end

RagefireChasm.triggers = {
	-- Web room
	Encounter_NewTriggerCircle("WREntrance", -192.676,84.6788,-24.0176,28,100, TriggerCircle_WREntrance),
	Encounter_NewTriggerCircle("BossIsland", -244.811,149.934,-18.7517,12,100, TriggerCircle_BossIsland),
	Encounter_NewTriggerCircle("WRL1Island", -268.416,93.3495,-25.0150,20,100, TriggerCircle_WRL1Island),
	Encounter_NewTriggerCircle("WRL2Island", -294.679,146.509,-25.1048,20,100, TriggerCircle_WRL2Island),
	Encounter_NewTriggerCircle("WRFnIsland", -301.017,213.545,-25.5106,30,10, TriggerCircle_WRFnIsland),
	Encounter_NewTriggerCircle("WRMeTopPth", -220.599,56.3839,-14.0695,20,100, TriggerCircle_WRMeTopPth),
	Encounter_NewTriggerCircle("WRR1Island", -188.023,153.787,-25.2197,15,100, TriggerCircle_WRR1Island),
	Encounter_NewTriggerCircle("WRR2Island", -229.949,210.088,-24.9153,20,100, TriggerCircle_WRR2Island),
};

RagefireChasm.encounters = {
	{name = "Oggleflint"},
	{name = "Taragaman the Hungerer", tpos = {-244.935, 149.820, -18.755},},
	{name = "Jergosh the Invoker"},
	{name = "Bazzalan"},
	{
		name               = "Global",
		test               = function() return true; end,
		UseLosBreakForPull = true,
		noboss             = true,
	},
};

RagefireChasm.encounters.LosTbl    = _losTbl;
RagefireChasm.encounters.AreaTbl   = _areaTbl;
RagefireChasm.encounters.RangedTbl = NPC_RANGED_LIST;
