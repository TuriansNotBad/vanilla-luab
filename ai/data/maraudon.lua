t_dungeons[349] = {
	
	------------------------------------------
	--           past merge area
	------------------------------------------
	
	-- Line 1 from red-purple merge to cave just past waterfalls
	{
		{772.836, -210.067, -65.6593, -1000, 2}, -- 1
		{794.636, -170.863, -74.5194, -1000, 2}, -- 2
		{840.41, -209.601, -75.6216, -1000, 2}, -- 3
		{870.91, -166.759, -87.0667, -1000, 2}, -- 4
		{870.789, -114.724, -87.0317, -1000, 2}, -- 5
		{844.651, -46.7463, -87.0891, -1000, 2}, -- 6
		{815.679, 45.2614, -86.9411, -1000, 2}, -- 7
		{716.408, 75.1663, -87.2091, -1000, 2}, -- 8
		{630.843, 92.8366, -86.8933, -1000, 2}, -- 9
		{588.864, 124.838, -95.3718, -1000, 2}, -- 10
		{552.489, 88.0233, -96.3127, -1000, 2}, -- 11
		{578.25, 23.9781, -96.3127, -1000, 2}, -- 12
		{494.839, 24.8957, -96.3128, -1000, 2}, -- 13
		{467.536, 126.365, -94.2239, -1000, 2}, -- 14
		{514.838, 147.646, -94.0471, -1000, 2}, -- 15
		{481.862, 184.68, -94.0471, -1000, 2}, -- 16
	},
	-- Line 2 waterfalls left path
	{
		{517.367, 2.55144, -96.3128, -1000, 2}, -- 1
		{482.491, -43.9537, -96.3128, -1000, 2}, -- 2
		{443.475, -47.0883, -96.3083, -1000, 2}, -- 3
	},
	-- Line 3 portal dead end
	{
		{641.565, 34.2341, -96.3128, -1000, 2}, -- 1
		{598.991, 24.4437, -96.3128, -1000, 2}, -- 2
		{595.803, 1.97456, -96.3129, -1000, 2}, -- 3
	},
	-- Line 4 toxic waterfalls dead end
	{
		{882.664, -196.954, -74.3668, -1000, 2}, -- 1
		{873.776, -210.469, -74.9836, -1000, 2}, -- 2
		{855.703, -213.682, -75.6048, -1000, 2}, -- 3
	},
	-- Line 5 cave to dead end right side long
	{
		{480.363, 184.768, -94.0473, -1000, 2}, -- 1
		{469.477, 256.646, -94.0483, -1000, 2}, -- 2
		{494.986, 262.343, -94.0483, -1000, 2}, -- 3
		{523.807, 204.635, -94.0483, -1000, 2}, -- 4
	},
	-- Line 6 cave to dead end right side short
	{
		{482.408, 186.896, -94.0483, -1000, 2}, -- 1
		{471.922, 214.789, -94.0483, -1000, 2}, -- 2
		{493.204, 227.286, -94.0483, -1000, 2}, -- 3
		{512.502, 206.299, -94.0483, -1000, 2}, -- 4
	},
	-- Line 7 cave fork to in cave fork
	{
		{480.246, 183.472, -94.0468, -1000, 2}, -- 1
		{440.728, 243.871, -94.1068, -1000, 2}, -- 2
		{384.559, 261.551, -94.0493, -1000, 2}, -- 3
		{345.806, 206.004, -101.918, -1000, 2}, -- 4
	},
	-- Line 8 cave fork dead end
	{
		{358.597, 200.777, -103.041, -1000, 2}, -- 1
		{398.506, 198.567, -112.887, -1000, 2}, -- 2
		{422.041, 273.581, -112.891, -1000, 2}, -- 3
	},
	-- Line 9 cave fork forward to hydra caves ends in waterfall lake
	{
		{355.9, 199.775, -102.508, -1000, 2}, -- 1
		{400.92, 188.158, -112.892, -1000, 2}, -- 2
		{427.606, 192.549, -112.892, -1000, 2}, -- 3
		{421.594, 141.944, -120.762, -1000, 2}, -- 4
		{335.127, 151.768, -131.75, -1000, 2}, -- 5
		{305.347, 75.3081, -131.02, -1000, 2}, -- 6
		{299.478, 22.9531, -130.98, -1000, 2}, -- 7
		{305.156, -54.6086, -131.01, -1000, 2}, -- 8
		{350.555, -99.9447, -131.01, -1000, 2}, -- 9
		{382.68, -65.1597, -130.981, -1000, 2}, -- 10
		{408.814, -3.7791, -137.322, -1000, 2}, -- 11
		{450.023, 12.1864, -142.938, -1000, 2}, -- 12
	},
	-- Line 10 waterfall lake past hydra cave to fork btwn final boss and goblin
	{
		{343.019, 58.5383, -130.999, -1000, 2}, -- 1
		{222.393, -49.2305, -131.002, -1000, 2}, -- 2
		{212.477, -93.5545, -129.601, -1000, 2}, -- 3
		{254.737, -93.8966, -129.621, -1000, 2}, -- 4
		{255.675, -122.739, -129.59, -1000, 2}, -- 5
		{210.579, -200.394, -131.159, -1000, 2}, -- 6
		{237.455, -268.331, -131.165, -1000, 2}, -- 7
		{278.089, -267.803, -120.98, -1000, 2}, -- 8
	},
	-- Line 11 prev fork to dead end
	{
		{281.798, -251.949, -120.653, -1000, 2}, -- 1
		{254.524, -234.357, -110.901, -1000, 2}, -- 2
		{266.072, -158.716, -110.942, -1000, 2}, -- 3
	},
	-- Line 12 prev fork to landslide
	{
		{280.838, -253.035, -120.613, -1000, 2}, -- 1
		{253.302, -237.682, -110.891, -1000, 2}, -- 2
		{246.489, -195.567, -111.03, -1000, 2}, -- 3
		{184.419, -186.839, -111.333, -1000, 2}, -- 4
		{211.376, -109.239, -92.3735, -1000, 2}, -- 5
		{289.165, -127.398, -78.6578, -1000, 2}, -- 6
		{298.849, -176.082, -59.8991, -1000, 2}, -- 7
		{322.751, -176.067, -59.8991, -1000, 2}, -- 8
		{356.442, -185.007, -59.8991, -1000, 2}, -- 9
	},
	-- Line 13 prev fork to final boss
	{
		{223.051, -198.151, -108.758, -1000, 2}, -- 1
		{184.974, -190.991, -111.14, -1000, 2}, -- 2
		{143.424, -230.814, -108.852, -1000, 2}, -- 3
		{156.5, -267.954, -108.676, -1000, 2}, -- 4
		{139.808, -278.337, -108.676, -1000, 2}, -- 5
		{73.4943, -248.169, -108.677, -1000, 2}, -- 6
		{68.1838, -203.433, -109.857, -1000, 2}, -- 7
		{7.77414, -128.327, -123.827, -1000, 2}, -- 8
		{19.122, -72.99, -127.725, -1000, 2}, -- 9
		{28.7902, 4.93082, -127.436, -1000, 2}, -- 10
		{24.7002, 48.857, -126.029, -1000, 2}, -- 11
	},
	-- Line 14 final boss turtle river
	{
		{-15.2447, -24.8689, -131.156, -1000, 2}, -- 1
		{-37.5773, 58.2365, -131.156, -1000, 2}, -- 2
		{-0.754742, 116.049, -131.156, -1000, 2}, -- 3
		{63.9352, 110.261, -131.156, -1000, 2}, -- 4
		{107.495, 57.2835, -131.156, -1000, 2}, -- 5
		{70.3263, -29.5669, -131.156, -1000, 2}, -- 6
	},
	-- Line 15 prev fork to goblin to underwater boss
	{
		{289.73, -252.674, -120.726, -1000, 2}, -- 1
		{327.191, -282.58, -118.074, -1000, 2}, -- 2
		{312.673, -340.091, -117.162, -1000, 2}, -- 3
		{312.524, -403.531, -124.867, -1000, 2}, -- 4
		{253.342, -393.788, -139.555, -1000, 2}, -- 5
		{252.306, -325.409, -140.843, -1000, 2}, -- 6
		{202.563, -319.011, -151.179, -1000, 2}, -- 7
		{207.89, -393.139, -160.849, -1000, 2}, -- 8
		{146.717, -376.31, -175.001, -1000, 2}, -- 9
		{144.902, -317.373, -174.407, -1000, 2}, -- 10
		{183.255, -302.37, -172.23, -1000, 2}, -- 11
		{173.102, -284.512, -170.717, -1000, 2}, -- 12
		{148.207, -280.446, -168.536, -1000, 2}, -- 13
		{139.721, -255.598, -167.736, -1000, 2}, -- 14
		{152.069, -208.434, -172.08, -1000, 2}, -- 15
		{77.5834, -182.489, -169.95, -1000, 2}, -- 16
		{41.301, -211.036, -169.194, -1000, 2}, -- 17
		{32.7443, -249.22, -169.908, -1000, 2}, -- 18
		{-33.6103, -251.418, -170.022, -1000, 2}, -- 19
		{-99.6221, -263.975, -170.419, -1000, 2}, -- 20
		{-125.721, -336.835, -170.419, -1000, 2}, -- 21
		{-56.3729, -360.538, -178.747, -1000, 2}, -- 22
		{-56.5635, -435.729, -189.263, -1000, 2}, -- 23
		{-7.14499, -436.321, -197.132, -1000, 2}, -- 24
		{5.07375, -363.927, -198.395, -1000, 2}, -- 25
		{15.3709, -301.906, -200.872, -1000, 2}, -- 26
		{5.96289, -218.724, -201.808, -1000, 2}, -- 27
		{30.9287, -144.918, -202.165, -1000, 2}, -- 28
		{44.0532, -79.0069, -198.591, -1000, 2}, -- 29
	},
	-- Line 16 cave before underwater boss dead end
	{
		{-79.0693, -417.91, -189.255, -1000, 2}, -- 1
		{-135.392, -412.02, -189.274, -1000, 2}, -- 2
	},
	
	------------------------------------------
	--            purple side
	------------------------------------------
	
	-- Line 17 second room fork
	{
		{755.078, -617.696, -32.9222, -1000, 2}, -- 1
		{758.153, -602.193, -33.2235, -1000, 2}, -- 2
		{801.949, -593.22, -32.4339, -1000, 2}, -- 3
		{768.94, -562.916, -32.824, -1000, 2}, -- 4
		{745.717, -551.231, -32.8448, -1000, 2}, -- 5
		{732.437, -507.277, -41.2365, -1000, 2}, -- 6
		{734.683, -475.062, -40.6517, -1000, 2}, -- 7
		{758.133, -467.657, -40.4101, -1000, 2}, -- 8
		{770.931, -470.488, -41.0807, -1000, 2}, -- 9
		{782.141, -487.729, -40.2249, -1000, 2}, -- 10
		{803.958, -494.016, -39.7329, -1000, 2}, -- 11
		{808.648, -522.085, -42.3299, -1000, 2}, -- 12
		{790.467, -532.455, -46.8574, -1000, 2}, -- 13
		{772.49, -519.722, -52.8765, -1000, 2}, -- 14
		{785.848, -501.184, -53.0403, -1000, 2}, -- 15
		{813.052, -484.768, -54.8345, -1000, 2}, -- 16
	},
	-- Line 18 waterfall dead end first room
	{
		{762.73, -488.615, -52.9629, -1000, 2}, -- 1
		{728.565, -440.472, -54.1063, -1000, 2}, -- 2
	},
	-- Line 19 prev fork dead end left
	{
		{813.476, -480.267, -55.0534, -1000, 2}, -- 1
		{824.648, -449.734, -56.3403, -1000, 2}, -- 2
		{796.839, -424.958, -53.665, -1000, 2}, -- 3
		{802.058, -381.033, -59.0596, -1000, 2}, -- 4
		{765.964, -347.761, -61.6861, -1000, 2}, -- 5
	},
	-- Line 20 prev fork dead end right
	{
		{799.441, -423.726, -53.5309, -1000, 2}, -- 1
		{820.687, -384.532, -59.2949, -1000, 2}, -- 2
		{856.022, -383.011, -64.1199, -1000, 2}, -- 3
	},
	-- Line 21 prev fork to poison falls big room
	{
		{834.5, -453.832, -56.3913, -1000, 2}, -- 1
		{861.353, -431.388, -52.6319, -1000, 2}, -- 2
		{886.523, -395.336, -52.0483, -1000, 2}, -- 3
		{870.031, -345.102, -50.7778, -1000, 2}, -- 4
		{811.554, -347.046, -51.7386, -1000, 2}, -- 5
		{763.365, -323.45, -51.5775, -1000, 2}, -- 6
		{743.658, -337.279, -50.6905, -1000, 2}, -- 7
		{682.128, -324.739, -52.0192, -1000, 2}, -- 8
		{654.518, -325.277, -52.0193, -1000, 2}, -- 9
		{629.292, -247.105, -52.9498, -1000, 2}, -- 10
		{631.785, -209.874, -64.3768, -1000, 2}, -- 11
		{677.905, -202.051, -60.543, -1000, 2}, -- 12
		{679.764, -253.918, -53.0708, -1000, 2}, -- 13
		{693.809, -262.289, -53.048, -1000, 2}, -- 14
		{703.951, -229.247, -47.2898, -1000, 2}, -- 15
		{689.484, -157.331, -48.5741, -1000, 2}, -- 16
		{617.419, -147.84, -54.394, -1000, 2}, -- 17
		{627.732, -111.37, -55.7925, -1000, 2}, -- 18
		{647.679, -107.604, -56.3868, -1000, 2}, -- 19
	},
	-- Line 22 hanging flame room left side
	{
		{739.657, -340.82, -50.8117, -1000, 2}, -- 1
		{718.539, -336.177, -51.6747, -1000, 2}, -- 2
		{691.394, -369.837, -52.0467, -1000, 2}, -- 3
		{623.376, -352.579, -52.0203, -1000, 2}, -- 4
		{611.535, -368.64, -52.0203, -1000, 2}, -- 5
	},
	-- Line 23 poison falls big room left 2/3 triangle
	{
		{649.846, -107.698, -56.3868, -1000, 2}, -- 1
		{695.104, -103.544, -56.0705, -1000, 2}, -- 2
		{741.433, -58.2597, -56.3612, -1000, 2}, -- 3
		{762.52, -69.6806, -56.4067, -1000, 2}, -- 4
		{778.88, -133.954, -56.1919, -1000, 2}, -- 5
	},
	-- Line 24 poison falls big room right to merge
	{
		{710.609, -104.317, -56.3195, -1000, 2}, -- 1
		{734.295, -104.682, -56.3796, -1000, 2}, -- 2
		{778.289, -155.903, -56.2172, -1000, 2}, -- 3
		{774.399, -172.063, -56.7701, -1000, 2}, -- 4
		{765.325, -186.248, -58.9611, -1000, 2}, -- 5
		{762.24, -206.558, -64.8574, -1000, 2}, -- 6
	},
	
	------------------------------------------
	--            orange side
	------------------------------------------
	
	-- Line 25 cave split dead end
	{
		{1025.37, -458.57, -43.3039, -1000, 2}, -- 1
		{1085.34, -444.106, -39.9537, -1000, 2}, -- 2
		{1083.08, -465.766, -36.8413, -1000, 2}, -- 3
		{1062.78, -467.826, -33.9593, -1000, 2}, -- 4
		{1055, -418.767, -32.1355, -1000, 2}, -- 5
		{1043.04, -319.538, -38.1006, -1000, 2}, -- 6
	},
	-- Line 26 cave split left to slime loop right semicircle
	{
		{1053.11, -418.858, -32.1128, -1000, 2}, -- 1
		{1041.04, -386.045, -36.2863, -1000, 2}, -- 2
		{1019.51, -375.398, -37.6322, -1000, 2}, -- 3
		{999.583, -325.303, -44.561, -1000, 2},
		{984.675, -297.4, -45.6584, -1000, 2}, -- 4
		{980.987, -280.075, -45.7114, -1000, 2}, -- 5
		{992.109, -249.123, -45.7114, -1000, 2}, -- 6
		{979.803, -231.477, -48.729, -1000, 2}, -- 7
	},
	-- Line 27 slime loop center
	{
		{974.916, -238.647, -48.7292, -1000, 2}, -- 1
		{964.768, -263.551, -48.8806, -1000, 2}, -- 2
	},
	-- Line 28 slime loop left
	{
		{1053.11, -418.858, -32.1128, -1000, 2}, -- 1
		{1041.04, -386.045, -36.2863, -1000, 2}, -- 2
		{1019.51, -375.398, -37.6322, -1000, 2}, -- 3
		{999.583, -325.303, -44.561, -1000, 2},
		{977.17, -309.144, -45.7598, -1000, 2}, -- 4
		{928.899, -245.345, -46.4601, -1000, 2}, -- 5
		{956.276, -218.372, -46.5562, -1000, 2}, -- 6
		{975.594, -227.657, -49.0356, -1000, 2}, -- 7
	},
	-- Line 29 slime loop to razorlash
	{
		{918.755, -248.16, -46.5899, -1000, 2}, -- 1
		{887.923, -272.479, -45.6992, -1000, 2}, -- 2
		{896.254, -303.923, -46.1958, -1000, 2}, -- 3
		{918.215, -348.639, -50.1267, -1000, 2}, -- 4
		{977.686, -377.147, -49.7563, -1000, 2}, -- 5
		{984.412, -358.703, -50.789, -1000, 2}, -- 6
		{1005.81, -313.186, -70.8232, -1000, 2}, -- 7
		{1034.02, -299.509, -71.9707, -1000, 2}, -- 8
		{1063.1, -320.5, -72.562, -1000, 2}, -- 9
		{1068.96, -269.736, -73.2326, -1000, 2}, -- 10
		{1040.96, -228.933, -72.2646, -1000, 2}, -- 11
		{1015.79, -206.176, -68.0954, -1000, 2}, -- 12
		{975.491, -181.732, -67.58, -1000, 2}, -- 13
		{936.875, -171.919, -62.2991, -1000, 2}, -- 14
		{965.214, -101.185, -63.739, -1000, 2}, -- 15
		{969.919, -58.4494, -61.9066, -1000, 2}, -- 16
		{978.458, -11.0408, -62.5854, -1000, 2}, -- 17
	},
	-- Line 30 noxxion straight line
	{
		{1090.22, -281.993, -72.5789, -1000, 2}, -- 1
		{1115.88, -244.505, -78.7832, -1000, 2}, -- 2
		{1129.42, -197.751, -80.0846, -1000, 2}, -- 3
	},
	-- Line 31 noxxion larva line
	{
		{1085.73, -259.148, -73.1376, -1000, 2}, -- 1
		{1082.33, -221.526, -73.8514, -1000, 2}, -- 2
		{1101.61, -198.312, -75.015, -1000, 2}, -- 3
	},
	-- Line 32 razorlash to merge
	{
		{949.625, -123.103, -62.2524, -1000, 2}, -- 1
		{961.621, -102.099, -63.5768, -1000, 2}, -- 2
		{949.31, -68.263, -61.9662, -1000, 2}, -- 3
		{916.691, -57.9472, -59.4223, -1000, 2}, -- 4
		{903.557, -64.9729, -59.2795, -1000, 2}, -- 5
		{911.788, -116.726, -61.8639, -1000, 2}, -- 6
		{898.618, -145.901, -60.547, -1000, 2}, -- 7
		{917.033, -185.074, -57.5827, -1000, 2}, -- 8
		{898.418, -201.803, -52.345, -1000, 2}, -- 9
		{858.498, -242.212, -53.7333, -1000, 2}, -- 10
		{816.58, -255.419, -60.4782, -1000, 2}, -- 11
		{782.984, -223.61, -65.0171, -1000, 2}, -- 12
	},
};

local Maraudon = t_dungeons[349];
Maraudon.Sludge = 
{
	key   = "Maraudon.Sludge.OldRole",
	Entry = 12222,
};

function Maraudon.Sludge:OnBegin(hive, data)
	Encounter_PreprocessAgents(self.key, data);
end

function Maraudon.Sludge:OnEnd(hive, data)
	local function restore_agent(ai, agent, aidata, data)
		aidata.targets = nil;
	end
	Encounter_RestoreAgents(self.key, data, restore_agent);
end

function Maraudon.Sludge:Update(hive, data)
	
	local sludges = {ignoreThreat = true};
	for i = #data.attackers, 1, -1 do
		local target = data.attackers[i];
		if (target:GetEntry() == self.Entry) then
			table.insert(sludges, target);
		end
	end
	
	for i,ai in ipairs(data.agents) do
		
		local agent = ai:GetPlayer();
		local bCanAttack = Encounter_GetRealRole(ai, self.key) == ROLE_RDPS;
		if (not bCanAttack and ai:GetRole() ~= ROLE_SCRIPT) then
			Encounter_ChangeRole(ai, self.key, ROLE_SCRIPT);
			Command_ClearAll(ai, self.key .. " claiming agent");
			Print(self.key, "taking over", agent:GetName());
		end
		
		local goal = ai:GetTopGoal();
		if (AI_DistanceIfNeeded(ai, agent, goal, hive, 7.0, nil, 30.0, true)) then
			bCanAttack = false;
		end
		
		local aidata = ai:GetData();
		if (bCanAttack) then
			aidata.targets = sludges;
		else
			aidata.targets = nil;
		end
		
	end
	
end

-- todo: this is terrible script
Maraudon.Princess =
{
	DustField = 21909,
	TankFleePos = {x = 27.724, y = 20.001, z = -126.253},
	RangeFleePos = {x = 30.003, y = -4.187, z = -127.362},
	MeleeFleePos = {x = 27.391, y = 13.286, z = -126.916},
};

function Maraudon.Princess:OnBegin(hive, data)
	for i,ai in ipairs(data.agents) do
		if (ai:GetRole() == ROLE_TANK) then
			-- ai:GetData().attackmode = "fury";
		end
	end
end

function Maraudon.Princess:OnEnd(hive, data)
	for i,ai in ipairs(data.agents) do
		ai:GetData().rchrpos = nil;
		ai:GetData().attackmode = nil;
	end
end

function Maraudon.Princess:Update(hive, data)
	
	-- non tanks avoid dust field
	local dfTarget = false;
	for i,target in ipairs(data.attackers) do
		if (target:GetAuraTimeLeft(self.DustField) > 2000) then
			dfTarget = target;
		end
	end
	
	for i,ai in ipairs(data.agents) do
	
		local agent = ai:GetPlayer();
		if (ai:GetRole() ~= ROLE_TANK and ((dfTarget and agent:GetDistance(dfTarget) < 22) or agent:GetHealthPct() < 50)) then
			if (ai:GetRole() ~= ROLE_MDPS) then
				ai:GetData().rchrpos = self.RangeFleePos;
			else
				ai:GetData().rchrpos = self.MeleeFleePos;
			end
		end
		
	end
	
	if (dfTarget) then
		return;	
	end
	
	for j,ai in ipairs(data.agents) do
		if (ai:GetRole() == ROLE_TANK and ai:CmdType() ~= CMD_TANK) then
			ai:GetData().rchrpos = self.TankFleePos;
		else
			ai:GetData().rchrpos = nil;
		end
	end
	
end

t_dungeons[349].encounters = {
	{name = "Creeping Sludge", script = Maraudon.Sludge},
	{name = "Lord Vyletongue"},
	{name = "Noxxion", tpos = {1139.853, -216.895, -79.264}, rchrpos = {x = 1142.188, y = -234.245, z = -79.264, melee = "dance"}, defensepot = 17546},
	{name = "Razorlash"},
	{name = "Celebras the Cursed", enemyPrio = {[12225] = 1}},
	{name = "Tinkerer Gizlock"},
	{name = "Landslide", tpos = {356.890, -185.147, -59.898}, rchrpos = {x = 339.584, y = -204.271, z = -59.898, melee = "dance"}, tanko = 0.73},
	{
		name = "Princess Theradras",
		tpos = {29.709, 44.964, -125.933},
		totemPos = {x = 29.709, y = 44.964, z = -125.933, d = 5.0, a = 4.66},
		rchrpos = {x = 27.391, y = 13.286, z = -126.916, melee = "ignore"},
		healmax = true,
		fear = true,
		script = Maraudon.Princess,
		bestRanged = true,
	},
	{name = "Rotgrip"},
};
