-- Moonshrine Ruins and opening area do not attempt pulling enemies that are underwater.
-- Cultist room, start on left side

import 'ai/common_encounter.lua'

t_dungeons[48] = {
	-- opening
	{
		{-150.234, 106.594, -39.779, -1000, 2}, -- 1
		{-165.417, 73.3755, -45.964, -1000, 2}, -- 2
		{-176.058, 64.2778, -48.7132, -1000, 2}, -- 3
		{-194.726, 48.7609, -53.1146, -1000, 2}, -- 4
		{-216.63, 37.3479, -53.3737, -1000, 2}, -- 5
		{-256.31, 35.6867, -55.9995, -1000, 2}, -- 6
		{-280.81, 30.208, -60.0538, -1000, 2}, -- 7
		{-308.286, 23.3307, -60.0538, -1000, 2}, -- 8
		{-333.188, 12.8936, -64.169, -1000, 2}, -- 9
		{-365.317, 18.8741, -57.8517, -1000, 2}, -- 10
	},
	-- to sarevess
	{
		{-312.91, 72.0724, -53.518, -1000, 2}, -- 1
		{-294.148, 86.6234, -51.731, -1000, 2}, -- 2
		{-299.393, 113.454, -53.2339, -1000, 2}, -- 3
		{-312.617, 119.157, -50.46, -1000, 2}, -- 4
		{-325.754, 121.229, -49.1231, -1000, 2}, -- 5
		{-346.367, 128.46, -50.9207, -1000, 2}, -- 6
		{-367.215, 141.111, -51.1716, -1000, 2}, -- 7
		{-372.8, 146.853, -51.8139, -1000, 2}, -- 8
		{-386.949, 160.52, -56.2277, -1000, 2}, -- 9
		{-382.311, 180.769, -57.2075, -1000, 2}, -- 10
		{-369.622, 248.034, -64.1715, -1000, 2}, -- 11
		{-377.139, 267.896, -66.5407, -1000, 2}, -- 12
		{-352.016, 301.048, -67.8018, -1000, 2}, -- 13
		{-341.278, 330.651, -55.9438, -1000, 2}, -- 14
		{-343.455, 365.103, -54.313, -1000, 2}, -- 15
		{-328.012, 393.608, -54.2147, -1000, 2}, -- 16
	},
	-- to thaelrid
	{
		{-383.171, 271.76, -65.9193, -1000, 2}, -- 1
		{-421.394, 284.046, -63.5897, -1000, 2}, -- 2
		{-455.007, 288.993, -60.7122, -1000, 2}, -- 3
		{-482.146, 317.819, -62.2477, -1000, 2}, -- 4
		{-503.108, 332.971, -52.0667, -1000, 2}, -- 5
		{-537.829, 306.885, -50.9327, -1000, 2}, -- 6
		{-511.839, 262.196, -63.8603, -1000, 2}, -- 7
		{-530.65, 220.655, -59.9991, -1000, 2}, -- 8
	},
	-- complete other half circle
	{
		{-390.425, 156.848, -56.4962, -1000, 2}, -- 1
		{-411.284, 143.285, -57.7594, -1000, 2}, -- 2
		{-447.533, 135.35, -63.6994, -1000, 2}, -- 3
		{-487.548, 151.175, -66.7314, -1000, 2}, -- 4
		{-526.84, 195.12, -60.67, -1000, 2}, -- 5
	},
	-- straight through from coast to ghamoo-ra to gelihast
	{
		{-391.899, 164.075, -56.3335, -1000, 2}, -- 1
		{-409.233, 180.013, -56.3744, -1000, 2}, -- 2
		{-415.478, 185.817, -54.0507, -1000, 2}, -- 3
		{-447.424, 202.374, -52.7851, -1000, 2}, -- 4
		{-478.057, 208.673, -53.5591, -1000, 2}, -- 5
		{-509.68, 212.763, -59.2596, -1000, 2}, -- 6
		{-548.409, 218.006, -58.4312, -1000, 2}, -- 7
		{-566.459, 227.758, -57.7592, -1000, 2}, -- 8
		{-579.133, 232.939, -53.6127, -1000, 2}, -- 9
		{-595.154, 223.11, -50.8097, -1000, 2}, -- 10
		{-611.426, 234.971, -51.2588, -1000, 2}, -- 11
		{-620.855, 207.201, -51.7588, -1000, 2}, -- 12
		{-615.769, 189.387, -53.2495, -1000, 2}, -- 13
		{-637.059, 154.719, -57.4542, -1000, 2}, -- 14
		{-635.665, 108.188, -57.5508, -1000, 2}, -- 15
		{-624.933, 73.3638, -55.6742, -1000, 2}, -- 16
		{-606.09, 44.2725, -53.9856, -1000, 2}, -- 17
		{-595.885, 32.5774, -52.1967, -1000, 2}, -- 18
		{-587.158, 22.7831, -48.6368, -1000, 2}, -- 19
		{-571.882, 8.07974, -48.1481, -1000, 2}, -- 20
		{-548.276, -2.87879, -42.7179, -1000, 2}, -- 21
		{-533.023, -4.26769, -40.3484, -1000, 2}, -- 22
		{-498.374, -6.94746, -46.2693, -1000, 2}, -- 23
		{-481.206, -0.619435, -47.7367, -1000, 2}, -- 24
		{-401.422, 28.979, -48.3602, -1000, 2}, -- 25
	},
	-- to lorgus variant 1
	{
		{-511.978, -13.9256, -43.9673, -1000, 2}, -- 1
		{-509.203, -34.0536, -43.4961, -1000, 2}, -- 2
		{-489.253, -38.0109, -43.5547, -1000, 2}, -- 3
		{-473.189, -41.3534, -38.3267, -1000, 2}, -- 4
		{-451.388, -37.8297, -31.8421, -1000, 2}, -- 5
	},
	-- to lorgus variant 2
	{
		{-508.262, -38.4994, -43.351, -1000, 2}, -- 1
		{-506.748, -65.3648, -42.9929, -1000, 2}, -- 2
		{-497.534, -82.7731, -44.1522, -1000, 2}, -- 3
		{-469.084, -87.3002, -39.3645, -1000, 2}, -- 4
	},
	-- to akumai
	{
		{-510.439, -39.1479, -43.0413, -1000, 2}, -- 1
		{-529.622, -42.415, -39.7181, -1000, 2}, -- 2
		{-548.809, -43.8717, -38.6075, -1000, 2}, -- 3
		{-569.073, -42.1366, -35.716, -1000, 2}, -- 4
		{-589.061, -38.3777, -31.0983, -1000, 2}, -- 5
		{-605.645, -32.8118, -25.232, -1000, 2}, -- 6
		{-624.847, -25.5244, -21.9428, -1000, 2}, -- 7
		{-635.357, -21.7785, -18.826, -1000, 2}, -- 8
		{-644.395, -18.4899, -17.7299, -1000, 2}, -- 9
		{-654.605, -13.5553, -17.8623, -1000, 2}, -- 10
		{-663.111, -2.08328, -20.6317, -1000, 2}, -- 11
		{-675.26, 15.8425, -27.5804, -1000, 2}, -- 12
		{-681.943, 25.3058, -30.0554, -1000, 2}, -- 13
		{-694.569, 33.1518, -31.2226, -1000, 2}, -- 14
		{-710.998, 36.8565, -30.4734, -1000, 2}, -- 15
		{-726.335, 29.8957, -30.4065, -1000, 2}, -- 16
		{-724.45, 13.3989, -30.0332, -1000, 2}, -- 17
		{-720.898, 1.53251, -30.2927, -1000, 2}, -- 18
		{-720.789, -14.6641, -37.7612, -1000, 2}, -- 19
		{-721.624, -58.3395, -37.7347, -1000, 2}, -- 20
		{-728.399, -58.4976, -37.7621, -1000, 2}, -- 21
		{-744.147, -58.4313, -30.0333, -1000, 2}, -- 22
		{-816.769, -57.7409, -29.6852, -1000, 2}, -- 23
		{-815.829, -75.4214, -29.7292, -1000, 2}, -- 24
		{-814.007, -82.3041, -27.3984, -1000, 2}, -- 25
		{-814.958, -91.645, -25.7527, -1000, 2}, -- 26
		{-818.368, -103.149, -25.8261, -1000, 2}, -- 27
		{-818.566, -108.377, -25.8692, -1000, 2}, -- 28
		{-834.637, -109.324, -25.8692, -1000, 2}, -- 29
		{-836.35, -138.569, -25.8692, -1000, 2}, -- 30
		{-835.231, -166.276, -25.8692, -1000, 2}, -- 31
		{-819.769, -188.022, -25.8716, -1000, 2}, -- 32
		{-817.97, -211.141, -25.872, -1000, 2}, -- 33
		{-829.41, -251.354, -25.87, -1000, 2}, -- 34
		{-845.251, -284.264, -26.8146, -1000, 2}, -- 35
		{-844.877, -312.021, -31.177, -1000, 2}, -- 36
		{-844.718, -342.112, -33.4515, -1000, 2}, -- 37
		{-842.785, -370.038, -33.8904, -1000, 2}, -- 38
		{-841.121, -399.092, -33.8904, -1000, 2}, -- 39
		{-841.274, -435.341, -33.8905, -1000, 2}, -- 40
		{-839.592, -474.375, -34.0559, -1000, 2}, -- 41
	},
	-- to serra'kis
	{
		{-733.32, 28.6207, -30.2789, -1000, 2}, -- 1
		{-752.881, 15.414, -29.6153, -1000, 2}, -- 2
		{-764.938, 1.58051, -28.9159, -1000, 2}, -- 3
		{-776.825, -17.8112, -31.0472, -1000, 2}, -- 4
		{-791.063, -33.659, -35.1848, -1000, 2}, -- 5
		{-818.855, -42.8284, -35.6047, -1000, 2}, -- 6
		{-838.807, -55.1227, -35.0669, -1000, 2}, -- 7
		{-836.888, -88.3329, -35.5468, -1000, 2}, -- 8
		{-808.755, -112.912, -36.3397, -1000, 2}, -- 9
		{-791.316, -157.848, -41.5066, -1000, 2}, -- 10
		{-732.69, -164.207, -50.0284, -1000, 2}, -- 11
	},
	-- first fork
	{
		{-716.915, -29.3259, -37.7381, -1000, 2}, -- 1
		{-698.106, -29.0805, -30.0332, -1000, 2}, -- 2
		{-693.503, -48.5184, -30.0347, -1000, 2}, -- 3
	},
	-- second fork
	{
		{-721.024, -61.3028, -37.7351, -1000, 2}, -- 1
		{-720.737, -87.1132, -37.5472, -1000, 2}, -- 2
		{-720.689, -102.863, -30.0448, -1000, 2}, -- 3
		{-743.351, -106.196, -30.0614, -1000, 2}, -- 4
	},
	-- moonshrine fork
	{
		{-815.663, -108.48, -25.8694, -1000, 2}, -- 1
		{-800.629, -108.348, -25.8694, -1000, 2}, -- 2
		{-798.265, -123.894, -25.8694, -1000, 2}, -- 3
		{-792.735, -142.379, -25.8694, -1000, 2}, -- 4
		{-780.212, -153.62, -25.8694, -1000, 2}, -- 5
		{-780.868, -169.138, -25.8694, -1000, 2}, -- 6
		{-810.602, -176.101, -25.9029, -1000, 2}, -- 7
	},
};

local BlackfathomDeeps = t_dungeons[48];

local _losTbl = Encounter_MakeLOSTbl()
	-- turtle lake
	.new 'TurtleBossRm' {-388.320, 166.681, -56.4142} {-373.009, 147.125, -51.8985}
	.new 'TurtleBossUL' {-407.646, 160.725, -57.7420} {-383.273, 159.406, -56.1941}
	.new 'TurtleBossU2' {-390.917, 154.992, -56.6724} {-371.937, 142.715, -51.6052}
	.new 'TurtleBossUF' {-473.292, 222.758, -53.4199} {-428.467, 224.468, -53.0448}
	.new 'TurtleBossLR' {-366.714, 269.398, -66.1520} {-383.109, 239.801, -62.9205}
	-- caves
	.new 'CaveForkNear' {-561.915, 5.37699, -46.4612} {-583.801, 16.4255, -48.9893}
	.new 'CaveForkOpps' {-532.034, -10.963, -39.7404} {-555.212, -1.0797, -44.4533}
	.new 'CaveForkMrgl' {-509.003, 20.1955, -45.5179} {-531.666, -9.0376, -40.1386}
	-- maze
	.new 'MazeEntrance' {-699.823, 27.97160, -30.384} {-679.528, 21.2751, -29.3080}
	.new 'MazeLeftRoom' {-720.145, -17.1681, -37.756} {-721.466, 1.24422, -30.4367}
	.new 'MazeForwRoom' {-726.951, -61.2826, -37.751} {-721.613, -37.916, -37.7350}
	.new 'MazeStraight' {-732.007, 4.144850, -30.033} {-745.740, 16.1683, -29.8518}
	.new 'MazeExitPar1' {-723.375, -51.9070, -37.734} {-721.199, -36.099, -37.7345}
	.new 'MazeExitPar2' {-770.741, -49.2875, -29.930} {-746.826, -59.084, -30.0332}
	-- ritual room
	.new 'RitualRoomEn' {-812.837, -100.310, -25.791} {-815.792, -83.1094, -27.1814}
.endtbl();

local _areaTbl = Encounter_MakeAreaTbl(_losTbl)
	-- turtle lake
	.new ('TurtleBossRm', SHAPE_POLYGON) {-368.802, 179.249} {-411.120, 243.496} {-460.433, 250.852} {-492.602, 199.883} {-398.288, 137.877}
		('TurtleBossRm', -50.00, 100.0)
	.new ('TurtleBossUL', SHAPE_POLYGON) {-437.054, 137.900} {-512.365, 105.982} {-607.792, 131.887} {-510.053, 202.494} ('TurtleBossUL', -50.00, 100.0)
	.new ('TurtleBossU1', SHAPE_POLYGON) {-384.779, 250.565} {-310.819, 226.621} {-303.683, 193.565} {-366.643, 176.193} ('TurtleBossU2', -50.00, 100.0)
	.new ('TurtleBossU2', SHAPE_POLYGON) {-468.782, 266.012} {-422.359, 344.423} {-400.891, 348.862} {-386.508, 244.391} ('TurtleBossU2', -50.00, 100.0)
	.new ('TurtleBossU3', SHAPE_POLYGON) {-400.325, 272.337} {-377.200, 247.084} {-325.395, 298.153} {-361.306, 317.695} ('TurtleBossLR', -50.00, 100.0)
	.new ('TurtleBossUF', SHAPE_POLYGON) {-475.457, 292.791} {-484.095, 90.4066} {-576.000, 145.994} {-576.000, 286.999} ('TurtleBossUF', -50.00, 100.0)
	.new ('TurtleBossLR', SHAPE_POLYGON) {-297.984, 303.770} {-362.842, 321.802} {-354.609, 376.924} {-252.861, 378.823} ('TurtleBossLR', -50.00, 100.0)
	-- caves
	.new ('CaveForkNear', SHAPE_POLYGON) {-533.821, -13.635} {-504.035, -21.783} {-494.828, 41.2079} {-538.379, 50.6315} ('CaveForkNear', -50.00, 100.0)
	.new ('CaveForkOpps', SHAPE_POLYGON) {-447.400, -16.200} {-447.400, -90.200} {-585.600, -90.200} {-585.600, -16.200} ('CaveForkOpps', -50.00, 100.0)
	.new ('CaveForkMrgl', SHAPE_POLYGON) {-396.800, 49.0000} {-396.800, -8.2000} {-478.500, -8.2000} {-478.500, 49.0000} ('CaveForkMrgl', -50.00, 100.0)
	-- maze
	.new ('MazeEntrance', SHAPE_POLYGON) {-759.193, 18.5603} {-720.282, 11.3948} {-715.872, -1.4190} {-766.978, -2.3473} ('MazeEntrance', -50.00, 100.0)
	.new ('MazeLeftRoom', SHAPE_POLYGON) {-716.577, -24.486} {-689.355, -24.369} {-689.765, -48.638} {-699.556, -49.639} ('MazeLeftRoom', -50.00, 100.0)
	.new ('MazeForwRoom', SHAPE_POLYGON) {-716.526, -70.098} {-715.934, -111.32} {-748.024, -110.70} {-748.122, -100.97} {-725.348, -68.725}
		('MazeForwRoom', -50.00, 100.0)
	.new ('MazeStraight', SHAPE_POLYGON) {-729.032, -69.342} {-728.462, -1.3581} {-714.874, -2.5334} {-714.465, -69.032} ('MazeStraight', -50.00, 100.0)
	.new ('MazeExitPar1', SHAPE_POLYGON) {-785.834, -42.582} {-785.823, -73.339} {-744.939, -74.262} {-743.379, -42.023} ('MazeExitPar1', -29.70, 3.0)
	.new ('MazeExitPar2', SHAPE_POLYGON) {-783.200, -43.664} {-829.617, -42.645} {-839.813, -102.26} {-784.319, -103.59} ('MazeExitPar2', -23.00, 7.0)
	-- ritual room
	.new ('RitualRoomEn', SHAPE_POLYGON) {-765.560, -113.56} {-765.560, -103.61} {-871.226, -103.61} {-871.226, -113.56} ('RitualRoomEn', -25.87, 4.0)
	.new ('RitualRoomPr', SHAPE_POLYGON) {-765.560, -113.56} {-765.560, -199.93} {-871.226, -199.93} {-871.226, -113.56} ('RitualRoomEn', -25.87, 4.0)
.endtbl();

local NPC_RANGED_LIST = Encounter_NewRangedList();
function NPC_RANGED_LIST.IsRanged() return true; end

BlackfathomDeeps.encounters = {
	{name = "Ghamoo-ra"},
	{name = "Lady Sarevess"},
	{name = "Gelihast"},
	{name = "Twilight Lord Kelris", sleep = true, tpos = {-818.897, -145.292, -25.870}},
	{name = "Aku'mai Servant", tpos = {-818.897, -145.292, -25.870}, rchrpos = {x=-818.861, y=-120.905, z=-25.870}, healmax = true},
	{name = "Old Serra'kis"},
	{name = "Aku'mai", poison = true, dispelFocus = {Poison = true}},
	{
		name               = "Global",
		test               = function() return true; end,
		UseLosBreakForPull = true,
		noboss             = true,
	},
	
	dispelFilter = function(target, hive, data, agents, friendly)
		if (not friendly) then return false; end
		-- Lady Sarevess: Slow
		-- Twilight Lord Kelris: Sleep
		if (target:HasAura(246) or target:HasAura(8399)) then return true, "Magic"; end
		-- Aku'Mai: Poison Cloud
		if (target:HasAura(3815)) then return true, "Poison"; end
		return false;
	end
	
};

BlackfathomDeeps.encounters.LosTbl    = _losTbl;
BlackfathomDeeps.encounters.AreaTbl   = _areaTbl;
BlackfathomDeeps.encounters.RangedTbl = NPC_RANGED_LIST;
